<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/styles/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/tufte.css"> <link rel=stylesheet  href="/css/latex.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=icon  href="/assets/favicon.png"> <title>Simple Linear Regression with Julia</title> <div id=layout > <div id=menu > <ul> <li><a href="/">Home</a> <li><a href="/about/">About</a> </ul> </div> <div id=main > <div class=franklin-content ><div class=franklin-toc ><ol><li><a href="#introduction">Introduction</a><ol><li><a href="#dataset">Dataset</a></ol><li><a href="#fitting_a_model">Fitting a model</a><ol><li><a href="#understanding_the_output">Understanding the output</a></ol><li><a href="#checking_the_model">Checking the model</a><ol><li><a href="#qq_plot">QQ Plot</a><li><a href="#independence_assumption">Independence assumption</a></ol><li><a href="#prediction">Prediction</a><li><a href="#conclusions">Conclusions</a><ol><li><a href="#references">References</a></ol></ol></div> <h3 id=introduction ><a href="#introduction" class=header-anchor >Introduction</a></h3> <p>Wikipedia defines <a href="https://en.wikipedia.org/wiki/Linear_regression">linear regression</a> to be &quot;a statistical model which estimates the linear relationship between a scalar response and one or more explanatory variables &#40;also known as dependent and independent variables&#41;.&quot;<sup id="fnref:1"><a href="#fndef:1" class=fnref >[1]</a></sup> Simple linear regression &#40;SLR&#41; is a special case of linear regression where there is only one explanatory variable, as opposed to multiple linear regression which uses more than one.</p> <p>The model for simple linear regression is</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>=</mo><mi>α</mi><mo>+</mo><mi>β</mi><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Y_i = \alpha + \beta x_i + W_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> <p>Where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Y_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the response variable, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the explanatory variable, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span> is the y-intercept, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span> is the slope, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">W_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the random &#40;error&#41; term. The random term is assumed to be normally distributed with mean zero and constant variance <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>, i.e. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub><mo>∼</mo><mi>N</mi><mo stretchy=false >(</mo><mn>0</mn><mo separator=true >,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">W_i \sim N(0, \sigma^2)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class=mopen >(</span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>.</p> <p>In this post we will use Julia to perform simple linear regression.</p> <h3 id=dataset ><a href="#dataset" class=header-anchor >Dataset</a></h3> <p>The dataset we&#39;ll work with is the <a href="https://archive.ics.uci.edu/ml/datasets/wine&#43;quality">&#39;Wine Quality&#39;</a> dataset from the <a href="https://archive.ics.uci.edu/">UCI Machine Learning Repository</a>, contributed by Cortez et al<sup id="fnref:2"><a href="#fndef:2" class=fnref >[2]</a></sup>. In particular, we&#39;ll use the &#39;winequality-red.csv&#39; file, which contains 1599 observations of 11 variables. We&#39;ll work with two variables from that file in particular, &#39;fixed acidity&#39; and &#39;density&#39;.</p> <p>&#39;fixed acidity&#39; - is x x x &#39;density&#39; repressents x x x</p> <p>We&#39;ll use the &quot;fixed acidity&quot; variable as the explanatory/indepenent variable, and the &quot;density&quot; variable as the response/dependent variable.</p> <p>To get started, we&#39;ll add the packages we&#39;ll need to the environment.</p> <p>Next, we&#39;ll download the dataset, </p> <pre><code class="julia hljs"><span class=hljs-comment >#import Downloads</span>
<span class=hljs-comment >#</span>
<span class=hljs-comment >#url = &quot;https://archive.ics.uci.edu/static/public/186/wine+quality.zip&quot;</span>
<span class=hljs-comment >#mkpath(&quot;../input&quot;)</span>
<span class=hljs-comment >#</span>
<span class=hljs-comment >#zippath = &quot;../input/wine_quality.zip&quot;</span>
<span class=hljs-comment >#</span>
<span class=hljs-comment >#Downloads.download(url, zippath)</span></code></pre> <p>and then unzip it. Note that in many cases I&#39;ll choose to import a package rather than use <code>using</code> since it makes it easy to see which package a function came from.</p> <pre><code class="julia hljs"><span class=hljs-comment >#import ZipFile</span>
<span class=hljs-comment >#</span>
<span class=hljs-comment >#zarchive = ZipFile.Reader(zippath)</span>
<span class=hljs-comment >#</span>
<span class=hljs-comment >#for f in zarchive.files</span>
<span class=hljs-comment >#  println(f.name)</span>
<span class=hljs-comment >#  fpath = joinpath(&quot;../input/&quot;, f.name)</span>
<span class=hljs-comment >#  write(fpath, read(f, String))</span>
<span class=hljs-comment >#end</span>
<span class=hljs-comment >#</span>
<span class=hljs-comment >#close(zarchive)</span></code></pre> <p>Now we&#39;ll read the data into a DataFrame</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> DataFrames
<span class=hljs-keyword >import</span> CSV


df = DataFrame(CSV.File(<span class=hljs-string >&quot;../input/winequality-red.csv&quot;</span>))
select!(df, <span class=hljs-string >&quot;density&quot;</span> =&gt; :y_density, <span class=hljs-string >&quot;fixed acidity&quot;</span> =&gt; :x_acidity)

first(df, <span class=hljs-number >5</span>)</code></pre> <pre><code class="plaintext hljs">ArgumentError: &quot;../input/winequality-red.csv&quot; is not a valid file or doesn&#x27;t exist
</code></pre> <p>Looking at the first five samples, they all have density that is just a little less than the density of water &#40;1.0&#41; and most of them are slightly acidic, since 7.0 is. One sample is very acidic &#40;11.2.&#41;</p> <h1 id=exploratory_data_analysis ><a href="#exploratory_data_analysis" class=header-anchor >Exploratory Data Analysis</a></h1> <p>Before we fit a model, we&#39;ll do some exploratory data analysis to get a feel for the data. Looking at the explanatory variable, acidity first, we have the following summary stats:</p> <pre><code class="julia hljs"><span class=hljs-keyword >import</span> StatsBase

StatsBase.describe(df.x_acidity)</code></pre> <pre><code class="plaintext hljs">UndefVarError: `df` not defined
</code></pre> <p>So the mean acidity is 8.3 and the standard deviation is 1.7. There are no missing values. Plotting a histogram of acidity we have.</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Plots
gr()

histogram(df.x_acidity, xlabel=<span class=hljs-string >&quot;acidity&quot;</span>, ylabel=<span class=hljs-string >&quot;count&quot;</span>, legend=<span class=hljs-literal >false</span>)</code></pre> <p><span style="color:red;">// Image matching '/assets/posts/2024-01-25_simple-linear-regression-with-julia/code/hist1' not found. //</span></p> <p>The histogram of acidity is unimodal and moderately right skewed. There appear to be some above a pH of 15. The model might be improved by removing these outliers, but for now I will leave them in.</p> <p>Looking at the density, the summary stats are as follows.</p> <pre><code class="julia hljs"><span class=hljs-keyword >import</span> StatsBase

StatsBase.describe(df.y_density)</code></pre> <pre><code class="plaintext hljs">UndefVarError: `df` not defined
</code></pre> <p>Again there are 1599 observations with no missing values. The mean is 0.996747 and the standard deviation is 0.001887.</p> <pre><code class="julia hljs">histogram(df.y_density, label=<span class=hljs-string >&quot;density&quot;</span>, xlabel=<span class=hljs-string >&quot;density&quot;</span>, ylabel=<span class=hljs-string >&quot;count&quot;</span>, legend=<span class=hljs-literal >false</span>)</code></pre>
<p><span style="color:red;">// Image matching '/assets/posts/2024-01-25_simple-linear-regression-with-julia/code/hist2' not found. //</span></p>
<p>The histogram of density is unimodal and appears to be mostly synmmetric.</p>
<p>Now lets explore at the relationship between the two variables with a scatterplot.  We&#39;re looking for a linear relationship between the two variables.</p>
<pre><code class="julia hljs">scatter(df.x_acidity, df.y_density,
  title=<span class=hljs-string >&quot;acidity vs density&quot;</span>, 
  xlabel=<span class=hljs-string >&quot;acidity&quot;</span>, 
  ylabel=<span class=hljs-string >&quot;density&quot;</span>, 
  markersize = <span class=hljs-number >1</span>, 
  legend=<span class=hljs-literal >false</span>
)</code></pre>
<p><span style="color:red;">// Image matching '/assets/posts/2024-01-25_simple-linear-regression-with-julia/code/scatter1' not found. //</span></p>
<p>The scatterplot shows a moderate, positive linear relationship between acidity and density.  Questions: does the variability look constant across x ? </p>
<h2 id=fitting_a_model ><a href="#fitting_a_model" class=header-anchor >Fitting a model</a></h2>
<p>We&#39;ll use the <code>StatsModels</code> package to create an R-style regression formula, then fit a model to that formula using the <code>lm</code> method from the <code>GLM</code> &#40;Generalized Linear Models&#41; package.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >import</span> StatsModels, GLM

<span class=hljs-comment ># Define the formula with R-style syntax, e.g. &quot;response ~ explantory_variable&quot;</span>
formula = StatsModels.<span class=hljs-meta >@formula</span>(y_density ~ x_acidity)
model = GLM.lm(formula, df)</code></pre>
<pre><code class="plaintext hljs">UndefVarError: `df` not defined
</code></pre>
<h3 id=understanding_the_output ><a href="#understanding_the_output" class=header-anchor >Understanding the output</a></h3>
<p>After fitting a model to the data, the <code>lm</code> command outputs the above table.</p>
<ul>
<li><p>The <code>coef</code> column lists the estimated regression coefficients of the model, first the estimated y-intercept and then the estimated regression coefficient for the explanatory variable, acidity.</p>

<li><p>A t-statistic is calculated for each coefficient and the corresponding t-value is listed in the &#39;t&#39; column.</p>

<li><p>The next column lists a p-value for each t-value.  This p-value is for the null hypothesis that the coefficient for acidity should be 0, i.e., that density and acidity are independent.   However, the p-value is very small, much smaller than 0.001 - it is probably as small as the GLM package can express.  This provides very strong evidence that the coefficient of acidty is not 0, and therefore suggests that there is a linear relationship between acididty and density.</p>

<li><p>The last two columns provide 95&#37; confidence intervals for the coefficients.  In particular, there is a 95&#37; probability that the interval &#40;0.000684567, 0.000763748&#41; contains the actual value of the coefficient, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>.</p>

</ul>
<p>We can get other information about the model by applying functions to the model object.  A table of these functions can be found <a href="https://juliastats.org/GLM.jl/stable/#Methods-applied-to-fitted-models">here</a>.</p>
<p>One useful method is the &#39;r2&#39; method &#40;r-squared&#41;, which can give us an idea of the &#39;goodness of fit&#39; of the model.</p>
<pre><code class="julia hljs">round(GLM.r2(model), digits=<span class=hljs-number >3</span>)</code></pre>
<pre><code class="plaintext hljs">UndefVarError: `model` not defined
</code></pre>
<p>This statistic implies that the model explains about 44.6&#37; of the variation in density.  </p>
<h1 id=the_fitted_model ><a href="#the_fitted_model" class=header-anchor >The Fitted Model</a></h1>
<p>Taking the estimated coefficients output above, we can now provide the fitted model.  To 5 decimal places, it is</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mover accent=true ><mtext>density</mtext><mo stretchy=true >^</mo></mover><mo>=</mo><mn>0.99072</mn><mo>+</mo><mn>0.00072</mn><mo>×</mo><mtext>acidity</mtext><mi mathvariant=normal >.</mi><mspace width=2em /><mtext>(to 5 d.p.)</mtext></mrow><annotation encoding="application/x-tex"> \widehat{\text{density}} =  0.99072 + 0.00072 \times \text{acidity}.  \qquad \text{(to 5 d.p.)} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1289em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.9344em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord text"><span class=mord >density</span></span></span><span class=svg-align  style="top:-3.6944em;"><span class=pstrut  style="height:3em;"></span><span style="height:0.24em;"><svg xmlns="http://www.w3.org/2000/svg" width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >0.99072</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >0.00072</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >acidity</span></span><span class=mord >.</span><span class=mspace  style="margin-right:2em;"></span><span class="mord text"><span class=mord >(to 5 d.p.)</span></span></span></span></span></span>
<p>We can interpret the fitted model as saying that for each unit increase in pH, the density increases by 0.00072 g/ml.</p>
<p>Plotting the model against the data we have</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> LaTeXStrings

scatter(df.x_acidity, df.y_density, label=<span class=hljs-string >&quot;acidity vs density&quot;</span>, xlabel=<span class=hljs-string >&quot;acidity&quot;</span>, ylabel=<span class=hljs-string >&quot;density&quot;</span>, 
  markershape = :circle,
  markersize = <span class=hljs-number >1</span>,
  legend=<span class=hljs-literal >false</span>
)

α̂, β̂ = GLM.coef(model)
plot!(fixed_acidity -&gt; α̂ + β̂ * fixed_acidity)</code></pre>
<p><span style="color:red;">// Image matching '/assets/posts/2024-01-25_simple-linear-regression-with-julia/code/fitted-model' not found. //</span></p>
<h2 id=checking_the_model ><a href="#checking_the_model" class=header-anchor >Checking the model</a></h2>
<p>A simple linear regression model, like</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>Y</mi><mo>=</mo><mi>α</mi><mo>+</mo><mi>β</mi><mi>x</mi><mo>+</mo><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Y = \alpha + \beta x + W_i </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
<p>A linear regression model should satisfy several assumptions in order to be valid and to be then used to make predictions or other inferences.  First, the response variables, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mn>1</mn></msub><mo separator=true >,</mo><msub><mi>Y</mi><mn>2</mn></msub><mo separator=true >,</mo><msub><mi>Y</mi><mi>i</mi></msub><mo separator=true >,</mo><mo>…</mo></mrow><annotation encoding="application/x-tex">Y_1, Y_2, Y_i,\ldots</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8778em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=minner >…</span></span></span></span> are independent random variables.  Further, each response variable <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Y_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is normally distributed with a mean of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>+</mo><mi>β</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">\alpha + \beta x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mord mathnormal">x</span></span></span></span> with a constant variance, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>Equivalently, we can say that these assumptions satisfied when</p>
<ul>
<li><p>There exists a linear relationship between </p>

<li><p>The random terms, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">W_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are </p>

</ul>
<p>A residual r is the difference between an observed value and a predicted value.  They are estimates of the random terms, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">W_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.  Hence the two assumptions above are equivalent to the following assumptions:</p>
<ul>
<li><p>that the relationship between the explanatory variable and the response variable is linear.</p>

<li><p>that the residuals have a zero mean and a constant variance.</p>

</ul>
<p>After fitting the model, we can check these assumptions with some diagnostic plots.  First we&#39;ll look at the residuals plot.  Residual are the differences between the observed response and the predicted response, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mi>y</mi><mo>−</mo><mover accent=true ><mi>y</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">r = y - \hat{y}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6944em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1944em;"><span class=mord >^</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span></span></span></span>.  In effect they are estimates of the random terms, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">W_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, which are supposed be normally distributed with a zero mean and a constant variance.</p>
<p>The residuals plot plots the value of the residuals against the explanatory variable.</p>
<pre><code class="julia hljs">scatter(df.x_acidity, GLM.residuals(model), 
  label=<span class=hljs-string >&quot;Residuals&quot;</span>, 
  xlabel=<span class=hljs-string >&quot;acidity, pH&quot;</span>, 
  ylabel=<span class=hljs-string >&quot;residual density&quot;</span>, 
  title=<span class=hljs-string >&quot;Residuals Plot&quot;</span>,
  msize=<span class=hljs-number >1</span>,
  legend=<span class=hljs-literal >false</span>
)

hline!([<span class=hljs-number >0</span>], linestyle= :solid)  <span class=hljs-comment ># Add a horizontal line at zero</span></code></pre>
<ul>
<li><p>It appears that the residuals are evenly distributed above and below the x-axis, so it seems like a reasonable assumption that the mean of the residuals is 0.</p>

<li><p>The width of the band scatter from about 5 to 10 appears to be the same - so it&#39;s reasonable to think the variance is constant through that range.  Above 10 or so, the band narrows.  this may be due to the smaller number of samples above 10 or it might be due to an actual change in variance.  From this, the assumption of variance seems questionable.</p>

</ul>
<h3 id=qq_plot ><a href="#qq_plot" class=header-anchor >QQ Plot</a></h3>
<p>Not only should the residuals have zero mean and constant variance, they should also be normally distributed.  We can check this assumption with a QQ plot.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >import</span> StatsPlots

StatsPlots.qqnorm(GLM.residuals(model), 
    qqline = :R, 
    markersize=<span class=hljs-number >1</span>, 
    xlabel=<span class=hljs-string >&quot;Theoretical Quantiles&quot;</span>, 
    ylabel=<span class=hljs-string >&quot;Standardized Residuals&quot;</span>,
    title=<span class=hljs-string >&quot;QQ Plot of Residuals&quot;</span>
)</code></pre>
<p><span style="color:red;">// Image matching '/assets/posts/2024-01-25_simple-linear-regression-with-julia/code/qq-plot' not found. //</span></p>
<p>From about -0.001 to 0.0025, the residuals appear to fall nicely on the line of equality.  However, outside of that range, the residuals appear to deviate systematically.  Hence the assumption that the random terms are normally distributed is questionable, especially outside of that range.</p>
<h3 id=independence_assumption ><a href="#independence_assumption" class=header-anchor >Independence assumption</a></h3>
<p>Finally, we assume that the random terms are independently distributed.  Satisfying this assumption is mostly a question of study design - how the data are collected.  However, we can plot the residuals in the order in which they were collected &#40;row id&#41; and check for the appearance of any pattern.</p>
<pre><code class="julia hljs">scatter(rownumber.(eachrow(df)), GLM.residuals(model),
  xlabel=<span class=hljs-string >&quot;observation id&quot;</span>, 
  ylabel=<span class=hljs-string >&quot;residual&quot;</span>, 
  xticks=<span class=hljs-number >0</span>:<span class=hljs-number >200</span>:<span class=hljs-number >1600</span>,
  yticks=-<span class=hljs-number >0.006</span>:<span class=hljs-number >0.001</span>:<span class=hljs-number >0.006</span>,
  title=<span class=hljs-string >&quot;Residuals vs. Sample Index&quot;</span>,
  msize=<span class=hljs-number >1</span>,
  legend=<span class=hljs-literal >false</span>
)</code></pre>
<p><span style="color:red;">// Image matching '/assets/posts/2024-01-25_simple-linear-regression-with-julia/code/time-order-plot' not found. //</span></p>
<p>Here, there does appear to be a distinct decrease in the mean residual value, by perhaps 0.002 or so.  The assumption that each residual is independent seems questionable.</p>
<h2 id=prediction ><a href="#prediction" class=header-anchor >Prediction</a></h2>
<p>Not all of the assumptions required for SLR appear to hold.  Nonetheless, SLR may still be robust to violations of those assumptions if the sample size is large.  With that in mind, we can go ahead an make some point and interval predictions for new values of the explanatory variable. </p>
<p>To obtain a point prediction, we can simply plug in the new value of the explanatory variable into the fitted model, or equivalently, use the GLM.predict function.</p>
<pre><code class="julia hljs">df_new = DataFrame(x_acidity = [<span class=hljs-number >7.0</span>])

print(round.(df_new.x_acidity .* β̂ .+ α̂, digits=<span class=hljs-number >5</span>))
print(round.(GLM.predict(model, df_new), digits=<span class=hljs-number >5</span>))</code></pre>
<pre><code class="plaintext hljs">UndefVarError: `β̂` not defined
</code></pre>
<p>We can also use <code>GLM.predict</code> to obtain a prediction interval with a specific confidence level.  </p>
<pre><code class="julia hljs">round.(GLM.predict(model, df_new, level=<span class=hljs-number >0.95</span>, interval=:prediction), digits=<span class=hljs-number >5</span>)</code></pre>
<pre><code class="plaintext hljs">UndefVarError: `model` not defined
</code></pre>
<p>Interpreting this interval, we expect that the interval &#40;0.99303  0.99855&#41; contains the true value of the density Y with a probability of 95&#37;.</p>
<h2 id=conclusions ><a href="#conclusions" class=header-anchor >Conclusions</a></h2>
<p>The Julia language has some good tools for performing simple linear regression which are quite similar to R.  It allows the user to specify regression formulas in a similar fashion to R.</p>

<div style="height: 8in;"></div>

<h3 id=references ><a href="#references" class=header-anchor >References</a></h3>
<p><table class=fndef  id="fndef:1">
    <tr>
        <td class=fndef-backref ><a href="#fnref:1">[1]</a>
        <td class=fndef-content >https://en.wikipedia.org/wiki/Linear_regression
    
</table>
 <table class=fndef  id="fndef:2">
    <tr>
        <td class=fndef-backref ><a href="#fnref:2">[2]</a>
        <td class=fndef-content >Silva, F. &amp; Cortez, P. &#40;2002&#41;. UCI Machine Learning Repository - Wine Quality &#40;https://archive.ics.uci.edu/dataset/186/wine&#43;quality&#41;.
    
</table>
</p>
<div class=page-foot >
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Joshua Whittemore. Last modified: February 09, 2024.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div>
        </div> 
    </div> 
    
        



    
    
        <script src="/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>